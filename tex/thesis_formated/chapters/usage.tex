\chapter{Usage}
\label{chap:usage}

This chapter provides a user guide with the necessary informations to use Henshin Web. Furthermore, it describes how to set up a development environment for Henshin Web.

\section{User Guide}
\label{sec:user_guide}

This chapter provides a user guide how to use Henshin Web. After starting the application at the landing page, users have to create an account and login to access an instance of Henshin Web. Each account has its own workspace that is persistent across sessions. The workspace is the space where all important files for Henshin are stored. Different models or projects can be structured in folders and subfolders. A Henshin project consists of at least a \textit{.ecore} metamodel file, a \textit{.henshin} transformation rules file, and optionally one or more \textit{.xmi} model files. In an empty folder, a new Henshin project can be created by clicking on \textit{New Project} in the explorer folder. It creates a starting point with the minimal content needed. Existing projects can also be imported by uploading the necessary files by right-clicking on a folder and selecting \textit{Upload Files}. 

All files are shown in the explorer of theia. \textit{.henshin} Rule files can be extended to see all containing rules as child nodes in the explorer. Here also new rules can be added by clicking on the \textit{+ Add} button in the explorer. When opening one of the three file types in the explorer, the graphical editor will be opened, allowing users to edit the file content dirctly on a graph. With \textit{Open With} in the context menu, the files can also be opened with a text editor. The handling of the graphs of the different file types works very similar. The opened graph can be moved and zoomed with the mouse by dragging the background with the mouse and scrolling the mouse wheel or a touchpad. Zooming and reseting the viewport can be also accesed over the toolbar of Theia. Nodes and edges can be selected by clicking on them. The selection of elements is necessary to move or delete elements. Nodes and edges can be moved by dragging and dropping them to a new position. Edges follow the position of their connected nodes, but can be rerouted temporarily. The position of the nodes are persisted in a notation file, to keep the layout across sessions. Notation files are stored in the \textit{.notation} folder in each project folder. They can be deleted to completely reset the layout. All editors support undo and redo operations, which can be accesed via the toolbar or the keyboard shortcuts \textit{Ctrl + Z} and \textit{Ctrl + Y}. Instance files provide the additional option to hide the root node. By toggling the \textit{Hide Root Node} button on the bottom right, the root node gets nearly invisible to give a better overview of big instance models.

On the right side of the editor is the tool palette, which contains all available elements that can be added to the diagram. To create a node you can click on the element in the palette and then click in the diagram to place it. To create an edge, you can click on the edge element in the palette and then the on the source node. After that a drawn edge line will follow the mouse cursor until you click on the target node to finish the edge creation. If a specific edge was drawn on a wrong source or target node, it wont be created. In the Instance editor, also the transformation rules can be applied over the tool palette. When clicking on a rule in the palette, a dialog opens where the parameters of the rule can be specified. The tool palette also contains icons to perform common actions. The editing mode can be switched between \textit{Selection Mode}, \textit{Deletion Mode} and \textit{Marque Mode}, where a square can be drawn to select multiple elements within. Next to that, a searchbar can be opened to filter and search the options of the tool palette.

Now elements of the graph can be created and deleted. To edit the properties of an element, different elements have different editor windows. They can be opened by double-clicking on an element or element part or by right clicking an element and selecteing the \textit{Open Properties} option in the context menu. All editors work similar. They contain a specific form where the properties of the selected element can be modified. The changes can be persisted by clicking outside of the editor window. That also closes the editor window. Here is a list of all available editor windows:

\begin{itemize}
    \item \textbf{Ecore editor}
    \begin{itemize}
        \item \textbf{Attribute Editor}: In this window the attributes of nodes can be modified. It can be opened by double clicking on the attribute part of a class node. You can see the window in figure \ref{fig:attribute-editor}. It allows to add, update and delete the name, type, multiplicity, and if the attribute is required. 
        \item \textbf{Operation Editor}: In this window the operations of nodes can be modified. It can be opened by double clicking on the operations part of a class node. You can see the window in figure \ref{fig:operation-editor}. It allows to add, update and delete operations. That inclueds the name, return type, parameters, visibility, and if the operation is abstract.
        \item \textbf{Reference Editor}: In this window the references of nodes can be modified. It can be opened by double clicking on an edge or its labels. You can see the window in figure \ref{fig:reference-editor}. It allows to edit the name and multiplicity of the reference and its opositie. You can also specify if the reference is a containment reference.
        \item \textbf{Enum Editor}: In this window the enums of nodes can be modified. It can be opened by double clicking on bottom part of a enum node. You can see the window in figure \ref{fig:enum-editor}. It allows to add, update and delete enum literals with their name, value and literal.
        \item \textbf{Datatype Editor}: In this window the datatypes of nodes can be modified. It can be opened by double clicking on a datatype node. It allows to specify the name, the instance class name of the datatype and if the data type is serializable.
    \end{itemize}
    \item \textbf{Henshin rule editor}
    \begin{itemize}
        \item \textbf{Action Type Editor}: In this window the action types of nodes can be modified. It can be opened by double clicking on the action type part of a node or an edge. It allows to change the action type of the node between \textit{Preserve}, \textit{Create}, \textit{Delete}, \textit{Forbid}.
        \item \textbf{Rule Editor}: In this window the name and parameters of a rule can be modified. It can be opened by clicking on the edit icon of the rule name box on the top left of the editor. You can see the window in figure \ref{fig:rule-editor}. This window can also be moved by dragging it. With this window, the rule can also be deleted. Here the changes have to be confirmed with the check icon on the bottom right or discarded with the cross icon on the top right.
    \end{itemize}
    \item \textbf{Instance editor}
    \begin{itemize}
        \item \textbf{Attribute value editor}: In this window the attribute values of nodes can be modified It opens when double clicking on an attribute label of a node. It allows to change the value of the attribute according to its type.
    \end{itemize}
\end{itemize}

\section{User Administration Guide}
\label{sec:admin-guide}

The deployment of Heshin Web with Theia Cloud provides a user management. Here users can be created, deleted and managed. The administration is done over the Keycloak admin console, which is available at \url{http://<your-domain>/auth/admin/} after the deployment of Henshin Web. 



\section{Development Setup}
\label{sec:dev-setup}

This section describes how to set up a complete development environment for the Henshin Web project. The project is built using Eclipse \ac{glsp} with a Java server backend and a Theia-based client frontend.

Before setting up the development environment, ensure that the following software components are installed on your system:

\begin{itemize}
    \item \textbf{Node.js} (version $\geq$ 18): Required for building and running the client application
    \item \textbf{Yarn} (version $\geq$ 1.7.0, $<$ 2.x.x): Package manager for JavaScript dependencies
    \item \textbf{Java} (version $\geq$ 17): Required for the GLSP server backend
    \item \textbf{Maven} (version $\geq$ 3.6.0): Build tool for the Java server component
\end{itemize}

First, get access to the gitlab repository, clone it and navigate to the project directory:

\begin{lstlisting}[language=bash]
git clone https://gitlab.uni-marburg.de/weidnerf/henshin-web-model-transformation.git
cd henshin-web-model-transformation
\end{lstlisting}

Before you can build the \ac{glsp} backend project, you need to specify maven authentication settings, to be able to access the private maven repository with the Henshin artefacts. To do that, create a \texttt{settings.xml} file in the \texttt{.m2} folder in your home directory (e.g., \texttt{C:\textbackslash Users\textbackslash <username>\textbackslash .m2\textbackslash settings.xml} on Windows). The file should contain the following content with your gitlab username and a personal access token as password:

\begin{lstlisting}[language=xml, caption=Maven Settings]
    <settings>
  <servers>
    <server>
      <id>gitlab-maven</id>
      <username>YOUR_USERNAME</username>
      <password>YOUR_PASSWORD</password>
      <configuration>
        <authenticationInfo>
          <userName>YOUR_USERNAME</userName>
          <password>YOUR_PASSWORD</password>
        </authenticationInfo>
      </configuration>
    </server>
  </servers>
</settings>
\end{lstlisting}


Navigate to the source directory and build both client and server components:

\begin{lstlisting}[language=bash]
cd src
yarn build
\end{lstlisting}

This command will build the GLSP server using Maven, install and build all client dependencies, and prepare the application for execution. Once the build is complete, start the application:

\begin{lstlisting}[language=bash]
cd glsp-client
yarn start
\end{lstlisting}

The application will be available at \url{http://localhost:3000}. 


If you want to debug the Java server, you have to start the client separately. So start the Java server in debug mode (e.g., with IntelliJ). You can then start the client with the following command in the \texttt{glsp-client} folder:

\begin{lstlisting}[language=bash]
yarn start:external
\end{lstlisting}

You can additionally use \code{yarn watch} in the \texttt{glsp-client} folder to automatically rebuild the client on code changes. That makes the development much easier, because you do not have to rebuild the client manually after each change.

To have a better overview of the project structure, here is a brief description of the main components of the Henshin Web project:

\begin{itemize}
    \item \textbf{Client Components}
    \begin{itemize}
        \item \textbf{\texttt{henshin-browser-app/}}: Main browser application integrating Theia with the \ac{glsp} extensions
        \item \textbf{\texttt{henshin-glsp/}}: Core \ac{glsp} client module containing code for custom \acs{ui} elements and logic. The module is used in all three following diagram editor modules. 
        \item \textbf{\texttt{ecore-theia/}}: Client module for the Ecore diagram editor. Contains code for context menu and command contributions.
        \item \textbf{\texttt{xmi-theia/}}: Client module for the XMI diagram editor. Contains code for context menu and command contributions.
        \item \textbf{\texttt{rules-theia/}}: Client module for the Henshin rule editor. Contains code for context menu and command contributions. It also contains the code for the Theia explorer extensions.
    \end{itemize}

    \item \textbf{Server Components}: The server project is structured in following parts for each diagram module and a base module:
    \begin{itemize}
        \item \texttt{actions/}: Custom actions for diagram operations
        \item \texttt{handler/}: Action handlers for diagram operations
        \item \texttt{model/}: Defines source model storage, graphical model factory, and state management
        \item \texttt{provider/}: Custom providers for the tool palette 
    \end{itemize}

    \item \textbf{Henshin SDK Packager}
    \begin{itemize}
        \item Pre-packaged Henshin SDK JAR files and dependencies
        \item Maven configuration for Henshin integration
        \item Deployment scripts for package registry
    \end{itemize}

\end{itemize}